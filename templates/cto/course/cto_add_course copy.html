{% extends 'cto/ctobase.html' %}
{% load widget_tweaks %}
{% load static %}
{% block content %}
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

<script>
  var products = [];
  var jsonData = [];
  function generateJSON(e) {
    debugger;
    let x = document.getElementById("course_name").value;
    if (x == "") {
      alert("Name must be filled out");
      document.getElementById("course_name").focus;
      e.preventDefault();
      return false;
    }
    
    //Store HTML Table Values into Multidimensional Javascript Array Object
    var TableData = new Array();
    $('#tblData tr').each(function (row, tr) {
      TableData[row] = {
        "subject": $(tr).find('td:eq(0)').text(),
        "chapter": $(tr).find('td:eq(1)').text()
      }//tableData[row]
    });
    if (TableData == false) {
      alert("Please Add subjects and Chapters");
      e.preventDefault();
      return false;
    }
    TableData.shift(); // first row will be empty - so remove
    JsonObject = JSON.parse(JSON.stringify(TableData));
    const jsonString = JSON.stringify(Object.assign({}, TableData))
    const json_obj = JSON.parse(jsonString);
    var textbox3 = document.getElementById('myvalue');
    textbox3.value = jsonString;
    alert(jsonString)
    return true;
  }
  function addallProduct() {
    //var field1 = document.getElementById("field1").value;
    var efield1 = document.getElementById("field1");
    var field1 = efield1.options[efield1.selectedIndex].innerHTML;
    var subject_id = efield1.options[efield1.selectedIndex].value;
    //var product_desc = document.getElementById("product_desc").value;
    var eProduct_desc = document.getElementsByName("chapters")[0];

    for (var i = 0; i < eProduct_desc.length; i++) {
      //var product_desc = eProduct_desc.options[eProduct_desc.selectedIndex].innerHTML;
      var product_desc = eProduct_desc.options[i].innerHTML;
      var chapter_id = eProduct_desc.options[i].value;

      if (product_desc == "Choose your Chapter") {
        continue;
      }
      var newProduct = {
        product_id: null,
        product_desc: null,
      };

      newProduct.product_id = subject_id + '-' + field1;
      newProduct.product_desc = chapter_id + '-' + product_desc;

      products.push(newProduct);
      var html = "<table id='tblData' border='1|1' >";
      html += "<tr>";
      html += "<th>Product ID</th>";
      html += "<th>Product Description</th>";
      html += "<th>Delete</th>";
      html += "</tr>";
      for (var i = 0; i < products.length; i++) {
        html += "<tr>";
        html += "<td>" + products[i].product_id + "</td>";
        html += "<td>" + products[i].product_desc + "</td>";
        html += "<td><button type='submit' onClick='deleteProduct(\"" + products[i].product_id + "\", this);'/>Delete Item</button> </td>";
        html += "</tr>";
      }
      html += "</table>";
      document.getElementById("demo").innerHTML = html;
    }
  }
  function removeItem(product_id) {
    for (var i = 0; i < products.length; i++) {
      if (products[i].product_id == product_id) {
        // DO NOT CHANGE THE 1 HERE
        products.splice(i, 1);
      }
    }
  }
  function deleteProduct(product_id, e) {
    e.parentNode.parentNode.parentNode.removeChild(e.parentNode.parentNode);
    for (var i = 0; i < products.length; i++) {
      if (products[i].product_id == product_id) {
        // DO NOT CHANGE THE 1 HERE
        products.splice(i, 1);
      }
    }
  }
  function addProduct() {
    //var field1 = document.getElementById("field1").value;
    var efield1 = document.getElementById("field1");
    var field1 = efield1.options[efield1.selectedIndex].innerHTML;

    //var product_desc = document.getElementById("product_desc").value;
    var eProduct_desc = document.getElementsByName("chapters")[0];
    var product_desc = eProduct_desc.options[eProduct_desc.selectedIndex].innerHTML;
    var newProduct = {
      product_id: null,
      product_desc: null,
    };
    var subject_id = efield1.options[efield1.selectedIndex].value;
    var chapter_id = eProduct_desc.options[eProduct_desc.selectedIndex].value;
    newProduct.product_id = subject_id + '-' + field1;
    newProduct.product_desc = chapter_id + '-' + product_desc;

    if (product_desc == "Choose your Chapter" || subject_id == "Choose your Subject") {
      return;
    }

    products.push(newProduct);

    var html = "<table id='tblData' border='1|1' >";
    html += "<td>Product ID</td>";
    html += "<td>Product Description</td>";
    html += "<th>Delete</th>";
    for (var i = 0; i < products.length; i++) {
      html += "<tr>";
      html += "<td>" + products[i].product_id + "</td>";
      html += "<td>" + products[i].product_desc + "</td>";
      html += "<td><button type='submit' onClick='deleteProduct(\"" + products[i].product_id + "\", this);'/>Delete Item</button></td>";
      html += "</tr>";
    }
    html += "</table>";
    document.getElementById("demo").innerHTML = html;
  }
  function savedata() {
    var TableData = new Array();
    $('#tblData tr').each(function (row, tr) {
      TableData[row] = {
        "Company": $(tr).find('td:eq(0)').text(),
        "Contact": $(tr).find('td:eq(1)').text()
      }//tableData[row]
    });
    TableData.shift();
    document.getElementById('myvalue').innerHTML = TableData;
    return TableData;
  };
  function validateForm() {
    debugger;
    let x = document.forms["addUser"]["course_name"].value;
    if (x == "") {
      alert("Name must be filled out");
      return false;
    }
  }
</script>
</head>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
<script src="https://unpkg.com/htmx.org@1.6.0"></script>
<div>
  <ol class="breadcrumb text-right">
    <li><a href="cto-dashboard">Dashboard</a></li>
    <li><a href="cto-view-course">View Courses</a></li>
    <li class="active">Add Course</li>
  </ol>
</div>
<div class="container">
  <h1>Add Course</h1>
  <div class="row">
    <div class="col-md-4 ">
      <form name="order" id="addUser" method="post">
        {% csrf_token %}
        <input type="hidden" name="myvalue" id="myvalue" value="Sdf67Ghbsdf786afdsdf">
        <table>
          <tr>
            <td>
              <label for="course_name">Course Name</label>
              <input class="custom-select mb-4 form-control" type="text" name="course_name" id="course_name" >
            </td>
          </tr>
          <tr>
            <td>
              <label for="field1">Subject Name</label>
              <select class="custom-select mb-4 form-control" id="field1" name="subject"
                hx-get="{% url 'trainer-view-material-chapters' %}" hx-trigger="change" hx-target="#div_chapters"
                >
                <option selected>Choose your Subject</option>
                {% for subject in subjects %}
                <option value="{{subject.pk}}">{{ subject.name }}</option>
                {% endfor %}
              </select>
            </td>
          </tr>
          <tr>
            <td>
              <div id="div_chapters">
                {% include 'cto/course/cto_course_chapters.html' %}
              </div>
              <input class="btn btn-primary form-control" type="button" id="btnAddallProduct" onclick="addallProduct();"
                value="Add All">
            <td>
              <input type="button" id="btnAddProduct" onclick="addProduct();" value="Add Selected">
            </td>
        </table>
        <button class="btn btn-primary form-control" type="submit" onclick="return generateJSON(event);">SUBMIT</button>
      </form>
    </div>
  </div>
</div>
<p id="validate"></p><br />
<p id="demo"></p> <br />
{% endblock %}
<script>

</script>
{% block javascript %}



</select>
{% endblock javascript %}