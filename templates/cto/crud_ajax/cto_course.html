{% load static %}
{% block content %}
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

<script>
  var products = [];
  var jsonData = [];
  function generateJSON() {

    //TotalRows=document.getElementById('tblData').getElementsByTagName('tbody')[0].rows;
    //TotalRows[1].getElementsByTagName("td")
    var myRows = [];
    var headers = ("th");
    var rows = ("tbody tr").each(function (index) {
      cells = (this).find("td");
      myRows[index] = {};
      cells.each(function (cellIndex) {
        myRows[index][$(headers[cellIndex]).html()] = $(this).html();
      });
    });
    var myObj = {};
    myObj.myrows = myRows;
    alert(JSON.stringify(myObj));
  }
  function addallProduct() {
    //var productID = document.getElementById("productID").value;
    var eProductID = document.getElementById("productID");
    var productID = eProductID.options[eProductID.selectedIndex].innerHTML;
    var subject_id = eProductID.options[eProductID.selectedIndex].value;
    //var product_desc = document.getElementById("product_desc").value;
    var eProduct_desc = document.getElementsByName("chapters")[0];

    for (var i = 0; i < eProduct_desc.length; i++) {
      //var product_desc = eProduct_desc.options[eProduct_desc.selectedIndex].innerHTML;
      var product_desc = eProduct_desc.options[i].innerHTML;
      var chapter_id = eProduct_desc.options[i].value;

      if (product_desc == "Choose your Chapter") {
        continue;
      }
      var newProduct = {
        product_id: null,
        product_desc: null,
      };

      newProduct.product_id = productID;
      newProduct.product_desc = product_desc;
      var selectElem = document.getElementById("field2");
      var element = document.createElement("option");
      element.innerText = subject_id + ' ' + chapter_id;
      selectElem.appendChild(element);
      products.push(newProduct);
      var html = "<table id='tblData' border='1|1' >";
      html += "<tr>";
      html += "<th>Product ID</th>";
      html += "<th>Product Description</th>";
      html += "<th>Delete</th>";
      html += "</tr>";
      for (var i = 0; i < products.length; i++) {
        html += "<tr>";
        html += "<td>" + products[i].product_id + "</td>";
        html += "<td>" + products[i].product_desc + "</td>";
        html += "<td><button type='submit' onClick='deleteProduct(\"" + products[i].product_id + "\", this);'/>Delete Item</button> </td>";
        html += "</tr>";
      }
      html += "</table>";
      document.getElementById("demo").innerHTML = html;
    }
  }
  function removeItem(product_id) {
    for (var i = 0; i < products.length; i++) {
      if (products[i].product_id == product_id) {
        // DO NOT CHANGE THE 1 HERE
        products.splice(i, 1);
      }
    }
  }
  function deleteProduct(product_id, e) {
    e.parentNode.parentNode.parentNode.removeChild(e.parentNode.parentNode);
    for (var i = 0; i < products.length; i++) {
      if (products[i].product_id == product_id) {
        // DO NOT CHANGE THE 1 HERE
        products.splice(i, 1);
      }
    }
  }
  function addProduct() {
    //var productID = document.getElementById("productID").value;
    var eProductID = document.getElementById("productID");
    var productID = eProductID.options[eProductID.selectedIndex].innerHTML;

    //var product_desc = document.getElementById("product_desc").value;
    var eProduct_desc = document.getElementsByName("chapters")[0];
    var product_desc = eProduct_desc.options[eProduct_desc.selectedIndex].innerHTML;
    var newProduct = {
      product_id: null,
      product_desc: null,
    };
    newProduct.product_id = productID;
    newProduct.product_desc = product_desc;
    var subject_id = eProductID.options[eProductID.selectedIndex].value;
    var chapter_id = eProduct_desc.options[eProduct_desc.selectedIndex].value;
    if (product_desc == "Choose your Chapter" || subject_id == "Choose your Subject") {
      return;
    }
    var selectElem = document.getElementById("field2");
    var element = document.createElement("option");
    element.innerText = subject_id + ' ' + chapter_id;
    selectElem.appendChild(element);
    products.push(newProduct);

    var html = "<table id='tblData' border='1|1' >";
    html += "<td>Product ID</td>";
    html += "<td>Product Description</td>";
    html += "<th>Delete</th>";
    for (var i = 0; i < products.length; i++) {
      html += "<tr>";
      html += "<td>" + products[i].product_id + "</td>";
      html += "<td>" + products[i].product_desc + "</td>";
      html += "<td><button type='submit' onClick='deleteProduct(\"" + products[i].product_id + "\", this);'/>Delete Item</button></td>";
      html += "</tr>";
    }
    html += "</table>";
    document.getElementById("demo").innerHTML = html;
  }
  function savedata() {
    debugger;
    
    var TableData = new Array();
    $('#tblData tr').each(function (row, tr) {
      TableData[row] = {
        "Company": $(tr).find('td:eq(0)').text(),
        "Contact": $(tr).find('td:eq(1)').text()
      }//tableData[row]
    });
    TableData.shift();
    document.getElementById('myvalue').innerHTML = TableData;
    alert(TableData)
    return TableData;
  };
  
</script>
</head>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
<script src="https://unpkg.com/htmx.org@1.6.0"></script>

<div class="container">
  <h1>Add Course</h1>
  <div class="row">
    <div class="col-md-4 ">
      <form name="order" id="addUser" method="post">
        {% csrf_token %}
        <input type="textarea" name="myvalue" id="myvalue" value="Sdf67Ghbsdf786afdsdf">
        <table>
          <tr>
            <td>
              <label for="productID">Subject Name</label>
              <select class="custom-select mb-4 form-control" id="productID" name="subject"
                hx-get="{% url 'trainer-view-material-chapters' %}" hx-trigger="change" hx-target="#div_chapters">
                <option selected>Choose your Subject</option>
                {% for subject in subjects %}
                <option value="{{subject.pk}}">{{ subject.name }}</option>
                {% endfor %}
              </select>
            </td>
          </tr>
          <tr>
            <td>
              <div id="div_chapters">
                {% include 'cto/course/cto_course_chapters.html' %}
              </div>
              <input class="btn btn-primary form-control" type="button" id="btnAddallProduct" onclick="addallProduct();"
                value="Add All">
            <td>
              <input type="button" id="btnAddProduct" onclick="addProduct();" value="Add New Product">
            </td>
            <tr>
              <td>
                <select name="selected_options" id="field2" size="5"></select>
              </td>
            </tr>
        </table>
        <button class="btn btn-primary form-control" type="submit" onclick="savedata();">SUBMIT</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
{% block javascript %}
<p id="demo"></p> <br />


</select>
{% endblock javascript %}